{% load static %}
<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}Dashboard - Software ERP{% endblock %}</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-flags.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-payments.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-vendors.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/demo.min.css">

    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/demo-theme.min.js"></script>
    <div class="page">
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-dark">
            <div class="container-fluid d-flex flex-column justify-content-start">
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu" aria-controls="sidebar-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
        
                <h1 class="navbar-brand navbar-brand-autodark mb-3">
                    <a href="/" class="text-decoration-none text-white d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-desktop-analytics me-2" width="32" height="32" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                           <path d="M3 4m0 1a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1z"></path>
                           <path d="M7 20h10"></path>
                           <path d="M9 16v4"></path>
                           <path d="M15 16v4"></path>
                           <path d="M9 12v-4"></path>
                           <path d="M12 12v-1"></path>
                           <path d="M15 12v-2"></path>
                        </svg>
                         ERP
                    </a>
                </h1>
        
                <div class="navbar-nav flex-row d-lg-none">
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm" style="background-image: url(https://tabler.io/img/avatars/000m.jpg)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Usuario</div>
                                <div class="mt-1 small text-secondary">Admin</div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="{% url 'logout' %}" class="dropdown-item">Cerrar sesión</a>
                        </div>
                    </div>
                </div>
        
                <div class="collapse navbar-collapse show" id="sidebar-menu" style="flex-grow: 0 !important;">
                    <ul class="navbar-nav pt-lg-3">
                        
                        <li class="nav-item {% if request.path == '/' %}active{% endif %}">
                            <a class="nav-link" href="/">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l-2 0l9 -9l9 9l-2 0" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" /></svg>
                                </span>
                                <span class="nav-link-title">Inicio</span>
                            </a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 7l1 0" /><path d="M9 13l6 0" /><path d="M13 17l2 0" /></svg>
                                </span>
                                <span class="nav-link-title">Facturación</span>
                            </a>
                        </li>
                        
                        <li class="nav-item {% if request.resolver_match.url_name == 'clientes_list' %}active{% endif %}">
                            <a class="nav-link" href="{% url 'clientes_list' %}">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" /><path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /><path d="M21 21v-2a4 4 0 0 0 -3 -3.85" /></svg>
                                </span>
                                <span class="nav-link-title">Clientes</span>
                            </a>
                        </li>
                        
                        <li class="nav-item {% if request.resolver_match.url_name == 'productos_list' %}active{% endif %}">
    
                            <a class="nav-link" href="{% url 'productos_list' %}">
                                
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5" /><path d="M12 12l8 -4.5" /><path d="M12 12l0 9" /><path d="M12 12l-8 -4.5" /><path d="M16 5.25l-8 4.5" /></svg>
                                </span>
                                <span class="nav-link-title">Productos</span>
                            </a>
                        </li>

                        <li class="nav-item {% if 'proveedores' in request.path %}active{% endif %}">
                            <a class="nav-link" href="{% url 'proveedor_list' %}">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <circle cx="7" cy="17" r="2" />
                                        <circle cx="17" cy="17" r="2" />
                                        <path d="M5 17h-2v-11a1 1 0 0 1 1 -1h9v12m-4 0h6m4 0h2v-6h-8m0 -5h5l3 5" />
                                    </svg>
                                </span>
                                <span class="nav-link-title">
                                    Proveedores
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'categorias_list' %}">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4h6v6h-6z" /><path d="M14 4h6v6h-6z" /><path d="M4 14h6v6h-6z" /><path d="M17 17m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /></svg>
                                </span>
                                <span class="nav-link-title">Categorías</span>
                            </a>
                        </li>
                        <hr class="my-3">

                        <li class="nav-item">
                            <form action="{% url 'logout' %}" method="post" class="d-inline w-100">
                                {% csrf_token %}
                                <button type="submit" class="nav-link text-danger border-0 bg-transparent w-100 text-start">
                                    <span class="nav-link-icon text-danger">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2" />
                                            <path d="M9 12h12l-3 -3m0 6l3 -3" />
                                        </svg>
                                    </span>
                                    <span class="nav-link-title">
                                        Cerrar Sesión
                                    </span>
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
                
            </div>
        </aside>

        <header class="navbar navbar-expand-md d-print-none">
            <div class="container-xl">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                    <a href="/">
                        <img src="{% static 'img/logo-empresa.jpg' %}" 
                             alt="Finca Latina"
                             width="110" 
                             height="auto" 
                             style="max-height: 40px; object-fit: contain;"> 
                    </a>
                </h1>
                <div class="navbar-nav flex-row order-md-last">
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list">
                            <a href="https://github.com/tabler/tabler" class="btn" target="_blank" rel="noreferrer">
                                <i class="ti ti-brand-github"></i>
                            </a>
                        </div>
                    </div>
                    <div class="nav-item dropdown d-none d-md-flex me-3">
                        <a href="#" class="nav-link px-0" data-bs-toggle="dropdown" tabindex="-1" aria-label="Show notifications">
                            <i class="ti ti-bell"></i>
                            <span class="badge bg-red"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-card">
                            <div class="card">
                                <div class="card-body">
                                    <div>Notificaciones</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                            <span class="avatar avatar-sm" style="background-image: url(https://tabler.io/img/avatars/000m.jpg)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Usuario</div>
                                <div class="mt-1 small text-secondary">Administrador</div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="#" class="dropdown-item">Perfil</a>
                            <a href="#" class="dropdown-item">Configuración</a>
                            <div class="dropdown-divider"></div>
                            <a href="{% url 'logout' %}" class="dropdown-item">Cerrar sesión</a>
                        </div>
                    </div>
                </div>
                <div class="collapse navbar-collapse" id="navbar-menu">
                    <div class="d-flex flex-column flex-md-row flex-fill align-items-stretch align-items-md-center">
                        <ul class="navbar-nav">
    
                            <li class="nav-item {% if request.path == '/' %}active{% endif %}">
                                <a class="nav-link" href="/">
                                    <span class="nav-link-title">Inicio</span>
                                </a>
                            </li>
                        
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span class="nav-link-title">Facturación</span>
                                </a>
                            </li>
                        
                            <li class="nav-item {% if request.resolver_match.url_name == 'clientes_list' %}active{% endif %}">
                                <a class="nav-link" href="{% url 'clientes_list' %}">
                                    <span class="nav-link-title">Clientes</span>
                                </a>   
                            </li>
                        
                            <li class="nav-item {% if request.resolver_match.url_name == 'productos_list' %}active{% endif %}">
                                <a class="nav-link" href="{% url 'productos_list' %}">
                                    <span class="nav-link-title">Productos</span>
                                </a>
                            </li>
                            <li class="nav-item {% if request.resolver_match.url_name == 'proveedor_list' %}active{% endif %}">
                                <a class="nav-link" href="{% url 'proveedor_list' %}">
                                    <span class="nav-link-title">Proveedores</span>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'categorias_list' %}">
                                     <span class="nav-link-title">Categorías</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>

        <div class="page-wrapper">
            
            {% block full_content %}

                <div class="page-header d-print-none">
                    <div class="container-xl">
                        <div class="row g-2 align-items-center">
                            <div class="col">
                                <div class="page-pretitle">
                                    Panel de control
                                </div>
                                <h2 class="page-title">
                                    {% block page_title %}Dashboard{% endblock %}
                                </h2>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="page-body">
                    {% block content %}
                        
                        <div class="container-xl">
                            <div class="row row-cards">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <h3 class="card-title">Bienvenido al Sistema ERP</h3>
                                            <p>Selecciona una opción del menú para comenzar.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% endblock %}
                </div>

            {% endblock %} 
            <footer class="footer footer-transparent d-print-none">
                <div class="container-fluid">
                    <div class="row text-center align-items-center flex-row-reverse">
                        <div class="col-lg-auto ms-lg-auto">
                            <ul class="list-inline list-inline-dots mb-0">
                                <li class="list-inline-item"><a href="#" class="link-secondary">Documentación</a></li>
                                <li class="list-inline-item"><a href="#" class="link-secondary">Soporte</a></li>
                            </ul>
                        </div>
                        <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                            <ul class="list-inline list-inline-dots mb-0">
                                <li class="list-inline-item">
                                    Copyright &copy; 2026
                                    <a href="." class="link-secondary">Software ERP</a>.
                                    Todos los derechos reservados.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
            <div class="modal modal-blur fade" id="modal-generic" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered" role="document" id="dialog">
                    </div>
            </div>
            
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
            
            
            <script src="{% static 'js/inventario.js' %}"></script>
            <script src="{% static 'js/modal_productos_handler.js' %}"></script>
            
            {% block scripts %}
            {% endblock %}
        


            
            <script>
                document.body.addEventListener('htmx:beforeSwap', function(evt) {
                    // Si el servidor nos responde con éxito (204)
                    if (evt.detail.xhr.status === 204) {
                        
                        // 1. Buscamos cualquier modal genérico que esté abierto en la pantalla
                        var openModal = document.querySelector('.modal.show');
                        if (openModal) {
                            var modalInstance = bootstrap.Modal.getInstance(openModal);
                            if (modalInstance) {
                                modalInstance.hide();
                            }
                        }
                        
                        // 2. El "Limpiador": Forzamos la destrucción de la pantalla negra si Bootstrap se traba
                        setTimeout(function() {
                            document.querySelectorAll('.modal-backdrop').forEach(function(backdrop) {
                                backdrop.remove(); // Matamos la capa oscura
                            });
                            document.body.classList.remove('modal-open'); // Desbloqueamos el scroll
                            document.body.style.overflow = '';
                            document.body.style.paddingRight = '';
                        }, 250); // Le damos un cuarto de segundo a la animación antes de forzar el cierre
                    }
                });
            </script>
            </body>
    </html>